{% load static %}

<!DOCTYPE html>

<html>

<head>
    <meta charset="utf-8">
    <title>IIIT</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <metahttp-equiv='cache-control' content='no-cache'>
        <metahttp-equiv='expires' content='0'>
            <metahttp-equiv='pragma' content='no-cache'>

                <link rel="stylesheet" type="text/css" href="{% static 'student_style.css'%}">

</head>

<body class="container">

    <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>

    <script>
        var updates = {}
            //var CSRF = $("input[name=csrfmiddlewaretoken]").val();

        const csrftoken = Cookies.get('csrftoken');

        function dirtybit(attendanceid, no) {

            var attended = document.getElementById("result").rows[no].cells[4]

            if (attended.innerHTML == "present") {
                attended.innerHTML = "absent"
                updates[attendanceid] = 0
            } else {
                attended.innerHTML = "present"
                updates[attendanceid] = 1
            }

            console.log(updates)
        }


        function csrfSafeMethod(method) {
            return ['GET', 'HEAD', 'OPTIONS', 'TRACE'].includes(method);
        }

        function sendJSON() {

            console.log("Button Clicked");

            $.ajaxSetup({
                beforeSend: function(xhr, settings) {
                    if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                        xhr.setRequestHeader("X-CSRFToken", csrftoken);
                    }
                }
            });

            $.ajax({
                url: "/faculty/attendance_update/",
                type: "POST",
                data: {
                    'updates': JSON.stringify(updates)
                },
                success: function(response) {
                    console.log("Seend successfully")
                }

            });

        }

        function home() {
            new_url = location.protocol + "//" + location.host + "/faculty/home";
            window.location.href = new_url;
        }

        function marks() {
            new_url = location.protocol + "//" + location.host + "/faculty/marks";
            window.location.href = new_url;
        }

        function timetable() {
            new_url = location.protocol + "//" + location.host + "/faculty/timetable";
            window.location.href = new_url;
        }

        function course() {
            new_url = location.protocol + "//" + location.host + "/faculty/course";
            window.location.href = new_url;
        }

        function logout() {
            new_url = location.protocol + "//" + location.host + "/logout";
            window.location.href = new_url;
        }
    </script>

    <header class="main-header">
        <a href="/" class="institute-logo">
            <img src="{% static 'IIIT_Logo.jpg'%}" class="IIIT-img">
            <div class="institute-name">IIIT</div>
        </a>
        <nav class="main-nav">
            <ul>
                <li><a href="Yash">Yash</a></li>
                <li><a href="javascript:;" onclick="logout()">Logout</a></li>
            </ul>
        </nav>
    </header>
    <div class="main-pg">
        <div class="nav-div">
            <nav class="navigation">
                <ul>
                    <li><a href="javascript:;" onclick="home()">Home</a></li>
                    <li><a href="">Attendance</a></li>
                    <li><a href="javascript:;" onclick='marks()'>Marks</a></li>
                    <li><a href="javascript:;" onclick='timetable()'>Time Table</a></li>
                    <li><a href="javascript:;" onclick='course()'>Courses</a></li>
                </ul>
            </nav>
        </div>
        <div class="content">

            <form method="POST">

                {{ form.as_p }} {% csrf_token %}
                <button type="submit">Submit</button>

            </form>

            <h4>{{ courseid }}</h4>
            <table id="result" border="1">

                <tr>
                    <th>#</th>
                    <th style="display:none">Attendance ID</th>
                    <th>Date</th>
                    <th>Day</th>
                    <th>Attended</th>
                </tr>


                {% for display in result %}
                <tr>
                    <td>{{display.1}}</td>
                    <td style="display:none">{{display.0}}</td>
                    <td>{{display.2}}</td>
                    <td>{{display.3}}</td>
                    {% if display.4 == 0 %}
                    <td>absent</td>
                    {% else %}
                    <td>present</td>
                    {% endif %}
                    <td><button onclick=dirtybit({{display.0}},{{display.1}});>Change</button></td>
                </tr>

                {% endfor %}

            </table>


            <button type="submit" onclick="sendJSON();">Save</button>

        </div>
    </div>
</body>

</html>